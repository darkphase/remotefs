<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="title" content="Remotefs, rfs_nss">
  <style type="text/css">
   body { 
      width: 17.5cm;
      font-size: 10pt;
      margin:0;
      padding-left: 1cm;
      padding-right:0.5cm; 
      border: solid 0px red;
   }
   p { text-align: justify; }
   th { text-align: left; background-color: #cccccc; }
   table { border-collapse:collapse;}
   td { border: 1px solid black; padding: 0.5em; vertical-align:top; }
   th { border: 1px solid black; padding: 0.5em; vertical-align:top; }
   .c { text-align: center; }
   .bl { text-align: left; background-color: #ddddff; }
   .ye { text-align: left; background-color: #ffffcc; }
   .super { position: relative; top: -0.4em; font-size: 0.5em; color:#cc0000; }
   .e { font-weight: bold; }
   pre { border: 1px blue solid; background: #ccccff; }
   .opt { font-weight: bold; width: 3em; float:left; }
   .cb  { clear:both; }
  </style>
 </head>
 <body>
  <h1>Access Control Lists</h1>
   The right management on UNIX<sup>&reg;</sup> systems is based on an owner
   (user), groups and the rest of the world (other),
  </p>
  <p>
   This model is nice but has some limitations. If user share common files with
   different access rights, for each users, this must be done by creating a lot
   of groups and the different user must be member of a lot of groups according
   to the wanted rights.
  </p>
  <p>
   Adding a lot of groups, managing them and assigning group membership to the
   concerned users can be complicated and the source of mistakes.
  </p>
  <p>
   If Alice want to give bob the access to a particular file, she can change the
   group ownership for the file. Both Alice and Bob must be member of this
   group, and if no other user are allowed to access the file, no other user
   shall be a member of this group.
  </p>
  <p>
   Setting the file ownership become impossible if there is no group
   corresponding to Alice needs. She must ask the administrator for creating a
   new group and can after the job is done assign the new group ownership to the
   file.
  </p>
  <p>
   The solution for this problem is to use Access Control Lists (ACL).
  </p>
  <p>
   The ACL allows to assign more as one user or group as ownership to a file or
   directory. Actually there are 2 main models, the POSIX ACL and the NFS4 ACL.
  </p>
  <h1>NFS4 ACL</h1>
  <p>
   This ACL model is similar to the Windows 2000 ACL, and contain a lot of
   access rights and inheritance rules.
  </p>
  <p>
   This model is not supported on the files system provided by Linux (ext2,
   ext3, ext4, xfs, ...). On openSolaris the ZFS files system support this
   ACL type, The older UFS files system don't support NFS4 ACL.
  </p>
  <p>
   The NFS4 ACL will probably become support on Linux, but only in a far future.
  </p>
  <h1>POSIX ACL</h1>
  <p>
   POSIX ACL is build in the major file systems used by Linux and is also well
   supported by FUSE.
  </p>
  <P>
   The POSIX ACL model rely on the UNIX<sup>&reg;</sup> and add to the user and
   group the ability to assign to further users and or groups the normal
   UNIX<sup>&reg;</sup> access rights (Read, Write, Execute).
  </p>
  <p>
   Directories can contain default entries which are applied to newly created
   files and directories.
  </p>
  <p>
   Alice task allowing bob to access a file is through the use of POSIX ACL very
   easy, Alice must only add an ACL (ACL Entry) for the file and tell that the
   user Bob as for example read right for this file.
  </p>
  <h2>POSIX ACL tools</h2>
  <p>
   2 command line utilities are provided. Getfacl allow to list the ACL for an
   object, setfacl allow modification or deleting of ACL.
  </p>
  <p>
   The desktops Gnome and KDE allows to modify the ACL, so that a normal user
   will be able to add, remove ACL entries or delete the ACL
   <ul>
    <li><b>Gnome</b>:<br /><i>Nautilus -&gt; Properties -&gt; Access Control List</i></li>
    <li><b>KDE 4</b>:<br /><i>Konqueror/Dolphin -&gt; Properties -&gt; Permissions -&gt; Advanced Permissions</i> </li>
   </ul>
  </p>
  <h2>Using the command line tools</h1>
  <h3>getfacl</h3>
  <p>
   Getfacl display the Entries of a file or a directory.
   <pre>
$ fgetacl somedir
# file : somedir
# owner: alice
# group: alice
user::rwx
user:alice:rwx
user::bob:rwx
user::deborah:---
group:r-x
group:adult:r-x
group:children:---
mask:rwx
other:---
default:user::rwx
default:user:alice:rwx
default:user:bob:rwx
default:group::r-x
default:group:adult:r-x
default:group:children:---
default:mask:rwx
default:other:---
</pre>
  </p>
  <p>
   These entries tell that alice has created the directory, or that the normal
   UNOX<sup>&reg;</sup> ownership is set to alice.
  </p>
  <p>
   The ACL entries contain 3 user which are marked too as owner of the file (alice, bob and deborah).
   This mean that as well alice the regular file owner as bob are able to modify or delete the file,
   the assigned rights are </i>rwx</i>. Deborah has no rights.
  </p>
  <p>
   The group entries contain the group adult and the group children. The member of
   the adult group have read and execute right. Member of the children group have no rights.
  </p>
  <p>
   Deborah may be member of the group adult, but alice and/or bob don't want that she have
   access on the directory and his children. The acl entry <i>user:deborah:---</i> prevail
   over other entries which may results into more rights (group adult).
  </p>
  <p>
   The line beginning with default tell that directory and files which will be created
   within the directory somedir inherit the acl rules.
  </p>
  <p>
   If bob create a file he will be the rehular owner and alice will have the same rights as
   bob according the the corresponding ACL entry.
  </p>
 <p>
  Refer also to manual page getfacl(1)
 </p>
  <h3>setfacl</h3>
  <p>
   Setfacl allows to set create ACL entries, to modify them to remove one or more entries or
   to remove all ACL entries.
  </p>
  <p>
   The most important options are:
   <ul>
    <li><div class="opt">-m</div> modify the ACL</li>
    <li class="cb"><div class="opt">-x</div> remove entry</li>
    <li class="cb"><div class="opt">-b</div> remove all named entries.</li>
    <li class="cb"><div class="opt">-d</div> apply the command to the default entries</li>
    <li class="cb"><div class="opt">-R</div> apply recursively</li>
   </ul>
  </p>
  <pre>
$ setfacl -m user:joe:rw file           # add an entry for user joe
$ setfacl -x user:joe:rw file           # remove the entry for user joe
$ setfacl -R -m default:user:joe:rw dir # add recursively the entry for user joe
</pre>
  <p>
    More as an entry can of course be added or removed.
  </p>
  <pre>
$ setfacl d:user:bob:rwx,d:alice:rwx,user:alice:rwx,user:bob:rwx file
</pre>
 <p>
  Refer also to manual page setfacl(1)
 </p>
 </body>
</html>
